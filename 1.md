# 第１章

例えば、以下のようなファイルが合ったとする

```txt
hogehugehirehare
fffhogehugehore
hogehogehugehuge
```

これを、以下のようにパイプでつなげることができる

```bash
grep -o hoge file.txt | wc -l
```

ここでは、-oによって一致する部分だけgrepし、パイプでつなげてwcコマンドでカウントしている

sedコマンドは、edをワンラインでできるようにしているだけ。

```bash
sed -n '1p' file
```

簡単に言うと、edモードのs(substitude)をそのままやってるだけ。-nは指定された行に一致する行のみ出力する。1は行数でpはプリントのエイリアス。vimのノーマルモードの操作に似ている。

もちろん書き換えることもできる。書き換える場合は以下のような形で行う。

```bash
sed 's/hoge/hogera/' file.txt > file_new.txt
```

edのsのポイントは、`s/hoge/huga`ではだめであること。必ず最後の/も必要。`s/hoge/huga/`という形で書くことに注意。また、vimと同じで末尾にgをつけると該当行の後ろの部分も連続して対象となる

grepが使い物になったことで、以下のようなコマンドを書くことができる。

```bash
grep hoge file.txt | sed 's/hoge/huga/g' > file_new2.txt
grep huga file_new2.txt | rev
```

echoの仕方について

```bash
echo text text2 text3
```

echoする際、間にスペース複数ある場合は、クォートで囲う

```bash
echo 'text  text2      text3'
```

マニュアルを章ごとに表示する場合は以下のような形で表示する

```bash
man 1 ls
```

ところで、lsではなくlでも行ける時がある。しかし、manでやっても表示されない。その場合どうするか？

答えは

```bash
type l
```

とすると、

```txt
l is an alias for ls -lah
```

と表示される

また、単に

```bash
alias l
```

とすると、`l='ls -lah'`と表示される

2つのディレクトリを行ったり来たりするとき

```bash
cd -
```

とやると、行ったり来たりできる。便利。

shellの機能として、ワイルドカードを使って検索したりとかもできる

```bash
grep mason ~/.config/nvim/lua/plugins/*.lua
```

echoで単にリストを表示することもできる

```bash
echo ~/.config/nvim/lua/plugins/*.lua
```

ワイルドカードには他にも種類がある。例えば

```bash
echo 2013??.rst
```

と言った形で表示することも可能

catを逆にしたtacがある。また、パイプや書き込みなどを組み合わせて、以下のように使うこともできる

```bash
tac ~/.config/nvim/lua/plugins/mason.lua | awk '{ print $1 }'
```

uniqで重複削除もできる

```bash
cat file.txt | uniq
```

ちなみに、例えば以下のコマンドが合ったとする

```bash
grep hoge *.txt | sed 's/:.*$//' | sort | uniq
```

この時、grepした時点では

```txt
file.txt:hoge
file.txt:hoge
file.txt:hogera
file_new.txt:hogerahugehirehare
file_new.txt:fffhogerahugehore
file_new.txt:hogerahogehugehuge
```

となるが、この内、:以降のテキストをsedでけして、ソートした後uniqにするというのをやっている。

以下のように実行したとする

```bash
echo aaa > hoge
grep a hoge | wc -l
```

この結果は1行なので1ではあるが、

```bash
grep a hoge | wc -l > hoge
```

とすると、0になる。なぜなら、最後に`> hoge`としているが、これに備えて中身が空になるようになっている。結果として、中身がないので0となる

逆に入力リダイレクトというものもある。例えば

```bash
cat hoge
cat < hoge
```

前者は、引数としてhogeをわたしており、後者は見つけたファイルをそのままわたしている。

例えば、以下の場合だと、入力リダイレクトが必要になる

```bash
tr '0' '1' < hoge
```

`<`を省略するとうまく動かない。

ただ、同じことを実現するのであれば、以下の撃ち方でも良い

```bash
cat hoge | tr '0' '1'
```

ちなみに、1行目の内容を2行目にコピーするには

```bash
sed -i "2a$(sed -n '1p' hoge)" hoge
```

と言ったことで実現できるらしい

sedの-nオプションは、該当箇所のみ表示するという抑制をつけるもの。説明には、

sedで検索して末尾に追加する場合、以下のように書くことができる

```bash
sed -n '/aarch64/p' info.txt >> fuga.txt
sed -n '/com/p' info.txt >> fuga.txt
```

ちなみに、この例だとgrepでもよい

```bash
grep 'aarch64' info.txt >> fuga.txt
grep 'com' info.txt >> fuga.txt
```

awkを使うとワンラインでかける

```bash
awk '/aarch64/ || /com/' info.txt >> fuga.txt
```
